var debug = {
    jp_list: [76200.21, 153400.34, 302300.52, 601900.11, 901500],
    ticketsMessages: [
        {
            kind: "tickets_msg",
            tickets: [
                {
                    series: "LACA",
                    ticket_id: 12345678,
                    price: 250,
                    content: {
                        fleet: [62,26,87,12,35,75,81,68,33,36,9,53,63,86,2,83,69,57,24,65,85,61,41,89,8,18,64,55,43,82,50,47,60,25,23,88,22,32,13,28,19,39,48,3,16,4,10,15,37,1,27,6,78,67,71,31,20,73,90,84,66,56,76,74,29,45,5,79,21,72,59,49,34,17,40,58,7,14,80,42,11,44,30,54,38,52,77,46,51,70],
                        ships: [
                            {
                                decks: 4,
                                position: 23,
                                orientation: "vertical"
                            },
                            {
                                decks: 3,
                                position: 85,
                                orientation: "horizontal"
                            },
                            {
                                decks: 3,
                                position: 36,
                                orientation: "horizontal"
                            },
                            {
                                decks: 2,
                                position: 1,
                                orientation: "horizontal"
                            },
                            {
                                decks: 2,
                                position: 20,
                                orientation: "horizontal"
                            },
                            {
                                decks: 2,
                                position: 5,
                                orientation: "horizontal"
                            }
                        ]
                    }
                }
            ]
        },
        {
            kind: "tickets_msg",
            tickets: [
                {
                    series: "LACA",
                    ticket_id: 3892034,
                    price: 500,
                    content: {
                        fleet: [8,23,1,63,14,46,71,65,30,4,29,9,70,50,18,22,17,25,54,10,20,77,38,37,64,42,81,32,83,36,19,56,28,58,76,26,47,90,85,52,49,84,43,79,33,61,66,73,7,68,3,35,27,86,24,41,21,39,75,2,5,62,89,80,78,51,82,60,55,74,12,11,40,72,87,44,45,59,16,67,6,48,15,31,13,88,69,53,34,57],
                        ships: [
                            {
                                decks: 4,
                                position: 61,
                                orientation: "horizontal"
                            },
                            {
                                decks: 3,
                                position: 76,
                                orientation: "horizontal"
                            },
                            {
                                decks: 3,
                                position: 55,
                                orientation: "horizontal"
                            },
                            {
                                decks: 2,
                                position: 20,
                                orientation: "vertical"
                            },
                            {
                                decks: 2,
                                position: 15,
                                orientation: "vertical"
                            },
                            {
                                decks: 2,
                                position: 49,
                                orientation: "vertical"
                            }
                        ]
                    }
                }
            ]
        },
        {
            kind: "tickets_msg",
            tickets: [
                {
                    series: "FAAA",
                    ticket_id: 6201201,
                    price: 1000,
                    content: {
                        fleet: [32,9,26,43,29,44,49,31,65,58,55,27,83,39,14,8,87,75,59,54,38,23,40,19,13,72,62,17,60,24,46,16,11,37,84,35,67,20,56,34,3,81,86,18,57,10,21,4,78,88,33,30,51,5,2,42,36,47,70,61,89,22,66,28,45,90,48,53,50,73,7,77,25,15,68,6,71,1,69,12,74,52,41,63,80,85,79,64,76,82],
                        ships: [
                            {
                                decks: 4,
                                position: 9,
                                orientation: "vertical"
                            },
                            {
                                decks: 3,
                                position: 4,
                                orientation: "horizontal"
                            },
                            {
                                decks: 3,
                                position: 45,
                                orientation: "vertical"
                            },
                            {
                                decks: 2,
                                position: 59,
                                orientation: "vertical"
                            },
                            {
                                decks: 2,
                                position: 82,
                                orientation: "horizontal"
                            },
                            {
                                decks: 2,
                                position: 85,
                                orientation: "horizontal"
                            }
                        ]
                    }
                }
            ]
        },
        {
            kind: "tickets_msg",
            tickets: [
                {
                    series: "FAAA",
                    ticket_id: 6201251,
                    price: 2000,
                    content: {
                        fleet: [16,73,51,64,77,57,56,19,15,48,5,54,49,55,40,62,32,46,7,13,30,29,23,24,50,8,75,36,67,34,38,42,1,9,35,6,11,44,43,52,39,83,80,85,88,81,17,76,14,4,25,10,82,45,28,68,18,70,78,20,61,53,72,2,86,27,71,84,12,33,90,65,41,79,69,31,60,87,66,47,26,63,21,58,22,89,3,59,37,74],
                        ships: [
                            {
                                decks: 4,
                                position: 65,
                                orientation: "horizontal"
                            },
                            {
                                decks: 3,
                                position: 3,
                                orientation: "vertical"
                            },
                            {
                                decks: 3,
                                position: 37,
                                orientation: "horizontal"
                            },
                            {
                                decks: 2,
                                position: 84,
                                orientation: "horizontal"
                            },
                            {
                                decks: 2,
                                position: 51,
                                orientation: "horizontal"
                            },
                            {
                                decks: 2,
                                position: 7,
                                orientation: "vertical"
                            }
                        ]
                    }
                }
            ]
        },
        {
            kind: "tickets_msg",
            tickets: [
                {
                    series: "FAAA",
                    ticket_id: 6201301,
                    price: 3000,
                    content: {
                        fleet: [40,42,23,29,15,62,58,4,25,48,20,9,19,79,86,47,43,1,28,26,71,69,81,11,90,63,8,54,34,52,77,10,57,41,72,67,56,87,17,74,45,2,59,83,84,16,18,46,64,49,88,60,39,82,21,32,22,3,12,61,70,13,85,33,6,89,65,38,7,5,30,75,53,24,27,66,14,50,73,35,80,36,68,76,44,37,51,31,55,78],
                        ships: [
                            {
                                decks: 4,
                                position: 35,
                                orientation: "horizontal"
                            },
                            {
                                decks: 3,
                                position: 42,
                                orientation: "vertical"
                            },
                            {
                                decks: 3,
                                position: 17,
                                orientation: "horizontal"
                            },
                            {
                                decks: 2,
                                position: 75,
                                orientation: "horizontal"
                            },
                            {
                                decks: 2,
                                position: 50,
                                orientation: "vertical"
                            },
                            {
                                decks: 2,
                                position: 82,
                                orientation: "horizontal"
                            }
                        ]
                    }
                }
            ]
        }
    ],
    rollbackMessage: {"game_data":{"balls":[],"end_bets_expected":"","game_id":50,"game_state":2,"jp_list":this.jp_list,"jp_wins":[],"total_win":0},"kind":"rand_msg"},
    initMessage: {kind: "init_msg",lang: "en",auth: {kind: "by_card",balance: 2000,nickname: "Tester"},game_data: {game_id: self.gameId,game_state: 1,balls: [],total_win: 0,jp_list: this.jp_list,jp_wins: []}},
    endBetsMessage: {kind: "rand_msg",game_data: {game_id: this.gameId,game_state: 2,balls: [],total_win: 0,jp_list: this.jp_list,jp_wins: []}},
    messages: [],
    currMessage: 0,
    currBalls: [],
    // список шаров которые должны выпасть (для тестирования различных ситуаций)
    presetBalls: [40, 66, 42, 23, 29, 14, 15, 83, 88, 84, 90, 70, 1, 11, 63, 15, 65, 37, 28, 26, 44, 67, 41, 63, 56, 87, 69, 17, 81],
    presetIndex: 0,
    delay: 2500,
    gameId: 1234,
    emulateRollback: false, // эмуляция отката
    gameCycle: function () {
        var self = this,
            next = function () {
                var ball,
                    check,
                    count = self.currBalls.length;

                if (count < 70) {
                    if (count === 12 && self.emulateRollback) {
                        self.emulateRollback = false;
                        self.currBalls = []; // сбрасываем старые шары
                        self.presetIndex = 0;

                        toJs(JSON.stringify(self.rollbackMessage));
                    } else {
                        if (self.presetIndex >= self.presetBalls.length) {
                            do {
                                ball = Math.floor(Math.random() * 70) + 1;
                                check = self.currBalls.indexOf(ball);
                            } while (check != -1);
                        } else {
                            ball = self.presetBalls[self.presetIndex];
                            self.presetIndex += 1;
                        }

                        self.currBalls.push(ball);

                        toJs(JSON.stringify({
                            kind: "rand_msg",
                            game_data: {
                                day: 1234,
                                tour: 57,
                                game_state: 2,
                                balls: self.currBalls,
                                total_win: 0,
                                jp_list: self.jp_list,
                                jp_wins: []
                            }
                        }));
                    }

                    setTimeout(function () {
                        next.call(self);
                    }, self.delay);
                } else {
                    toJs(JSON.stringify({
                        kind: "rand_msg",
                        game_data: {
                            day: 1234,
                            tour: 57,
                            game_state: 1,
                            balls: self.currBalls,
                            total_win: 0,
                            jp_list: self.jp_list,
                            jp_wins: [
                                {
                                    series: "LACA",
                                    ticket_id: 12345678,
                                    step: 8,
                                    win_sum: 20000
                                },
                                {
                                    series: "LACA",
                                    ticket_id: 3892034,
                                    step: 10,
                                    win_sum: 40000
                                }
                            ]
                        }
                    }));
                    self.currBalls = [];
                    self.gameId += 1;
                    self.presetIndex = 0;
                    self.currMessage = 0;

                    setTimeout(function () {
                        self.gameCycle();
                    }, 12000);

                    /*toJs(JSON.stringify({
                     kind: "exit_msg"
                     }));*/
                }
            };

        if (this.currMessage < this.messages.length) {
            toJs(this.messages[this.currMessage]);
            this.currMessage += 1;

            setTimeout(function () {
                self.gameCycle();
            }, self.delay);
        } else {
            setTimeout(function () {
                next.call(self);
            }, self.delay);
        }
    },
    init: function () {
        var self = this,
            i;

        this.messages.push(JSON.stringify(this.initMessage));
        for (i = 0; i < 5; i += 1) {
            this.messages.push(JSON.stringify(this.ticketsMessages[i]));
        }
        this.messages.push(JSON.stringify(this.endBetsMessage));

        window['cppObj']['fromJs'] = function (str) {
            var data,
                error = {};
            try {
                data = JSON.parse(str);
            } catch (e) {
                data = undefined;
                error = e;
            }

            if (typeof data === 'object' && typeof data['kind'] === 'string') {
                if (data['kind'] === 'exited_msg') {
                    console.log('game exited');
                }
            } else {
                return console.log((error.message || 'bad json') + ' (' + str + ')');
            }
        };

        self.gameCycle();
    }
};